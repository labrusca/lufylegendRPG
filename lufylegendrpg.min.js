function LTileMap(a,b,c,d,e){var g,h,f=this;base(f,LSprite,[]),f.type="LTileMap",f.x=0,f.y=0,f.mapData=a,f.imgData=b,f.mapSprite=new LSprite,f.addChild(f.mapSprite),f.textSprite=new LSprite,f.addChild(f.textSprite),c?f.partWidth=c:(g=new LBitmapData(f.imgData),f.partWidth=g.image.width),d?f.partHeight=d:(h=new LBitmapData(f.imgData),f.partHeight=h.image.height),f.mapTerrain=e?e:[],f.onshow()}function LEffect(){var a=this;base(a,LSprite,[]),a.type="LEffect",a.rainList=[],a.snowList=[],a.rainLayer=new LSprite,a.rainLayer.alpha=.8,a.addChild(a.rainLayer),a.snowLayer=new LSprite,a.snowLayer.alpha=.8,a.addChild(a.snowLayer)}function LCurtainSample1(a,b,c){var d=this;base(d,LSprite,[]),d.type="LCurtainSample1",a||(a=LStage.width/100),d.onClosing=b?b:function(){},d.onComplete=c?c:function(){},d.mode="close",d.width1=0,d.width2=0,d.isDoClosing=!1,d.speed=a,d.addEventListener(LEvent.ENTER_FRAME,d.onshow)}function LCurtainSample2(a,b,c){var d=this;base(d,LSprite,[]),d.type="LCurtainSample2",a||(a=LStage.height/100),d.onClosing=b?b:function(){},d.onComplete=c?c:function(){},d.mode="close",d.height1=0,d.height2=0,d.isDoClosing=!1,d.speed=a,d.addEventListener(LEvent.ENTER_FRAME,d.onshow)}function LCurtainSample3(a,b,c){var d=this;base(d,LSprite,[]),d.type="LCurtainSample3",a||(a=LStage.width/100),d.onClosing=b?b:function(){},d.onComplete=c?c:function(){},d.mode="close",d.height1=0,d.height2=0,d.width1=0,d.width2=0,d.isDoClosing=!1,d.speed=a,d.addEventListener(LEvent.ENTER_FRAME,d.onshow)}function LTalk(a){var b=this;base(b,LSprite,[]),b.type="LTalk",b.content=a?a:[],b.x=0,b.y=0,b.textWidth=LStage.width,b.talkIndex=0,b.faceX=0,b.faceY=0,b.nameX=0,b.nameY=0,b.nameColor="black",b.nameFont="宋体",b.nameSize="15",b.msgX=0,b.msgY=0,b.msgColor="black",b.msgFont="宋体",b.msgSize="15"}function LCharacter(a,b,c,d,e){var g,h,f=this;base(f,LSprite,[]),f.type="LCharacter",d||(d=0),void 0==e&&(e=!1),f.speed=d,f.speedIndex=0,f.x=0,f.y=0,f.mode="",f.index=0,1==e&&(f.hp=0,f.attack=0,f.defense=0),f.effect=null,f.avatarNum=0,f.flickerNum=0,f.img=a,f.row=b,f.col=c,f.effectSprite=new LSprite,f.addChild(f.effectSprite),f.nameSprite=new LSprite,f.addChild(f.nameSprite),g=new LBitmapData(a),g.setProperties(0,0,g.image.width/c,g.image.height/b),h=LGlobal.divideCoordinate(g.image.width,g.image.height,b,c),f.imgWidth=g.image.width/c,f.imgHeight=g.image.height/b,f.anime=new LAnimation(f,g,h),f.addEventListener(LEvent.ENTER_FRAME,function(){null!=f.effect&&f.showEffect(f,f.effect)})}function LHitList(a,b,c){a||trace("Error: The first param was not assigned."),b||trace("Error: The second param was not assigned."),c||(c="TestRect");var d=this;base(d,LObject,[]),d.type="LHitList",d.objectA=a,d.objectB=null,d.sprite=b,d.ishit=!1,d.list=[],d.type=c}function LBackground(a,b){var c=this;base(c,LSprite,[]),c.type="LBackground",a||trace("Error: First param is wrong!"),b||(b=LBackStyle.tile),c.data=a,c.x=0,c.y=0,c.mode=b,c.onshow(c.mode)}function LXMLToArray(a,b){var c=this;base(c,LObject,[]),c.type="LXMLToArray",c.xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b||(b="map"),c.xmlPath=a,c.type=b,c.xmlhttp.open("GET",c.xmlPath,!1),c.xmlhttp.send(),c.xmlDoc=c.xmlhttp.responseXML}function LSceneData(a,b,c,d){var e=this;e.type="LSceneData",e.backObj=a||"no",e.charaList=b||[],e.talkContent=c||[],e.weather=d||"normal"}function LScene(a){var b=this;base(b,LSprite,[]),b.type="LScene",b.data=a,b.removeAllChild(),b.mapLayer=new LSprite,b.addChild(b.mapLayer),b.charaLayer=new LSprite,b.addChild(b.charaLayer),b.talkLayer=new LSprite,b.addChild(b.talkLayer),b.weatherLayer=new LSprite,b.addChild(b.weatherLayer),b.mapObj=null,b.mapData=[],b.mapTerrain=[],b.mapPartWidth=0,b.mapPartHeight=0,b.mapCanWalk=0,b.mapCannotWalk=1,b.mapMove=!1,b.movemapRight=0,b.movemapLeft=0,b.movemapUp=0,b.movemapDown=0,b.charaList=new Array,b.player=null,b.playerDir=null,b.playerX=0,b.playerY=0,b.step=0,b.stepIndex=0,b.isWalk=!1,b.characterList=b.charaLayer.childList,b.playerStep=UNDEFINED,b.charaLeftStyle=0,b.charaUpStyle=0,b.charaRightStyle=0,b.charaDownStyle=0,b.talk=new LTalk,b.talkList=b.data.talkContent,b.talkNum=0,b.talking=!1,b.talkBack=null,b.walkCompleteFunc=null,b.weatherObj=null,b.addEventListener(LEvent.ENTER_FRAME,function(){b.onframe()}),LEvent.addEventListener(LGlobal.window,LKeyboardEvent.KEY_DOWN,function(){b.onkeydown(event)}),LEvent.addEventListener(LGlobal.window,LKeyboardEvent.KEY_UP,function(){b.onkeyup(event)}),"no"!=b.data.backObj&&("LTileMap"==b.data.backObj.type?b.addMap():"LBackground"==b.data.type&&b.addBackground()),b.data.charaList!=[]&&b.addCharacter(),"normal"!=b.data.weather&&b.addWeather()}var LRPG,LRPGGlobal,LKeyboard,LMoveStyle,LSkill,LBackgroundStyle,LPlayerMove,LRPGStage=function(){};LRPGStage.shortcuts=!1,LRPGStage.type="LRPGStage",LRPGStage.setShortcuts=function(a){LRPGStage.shortcuts=a},LRPGStage.closePage=function(){var a=navigator.appName;"Netscape"==a?(window.open("","_parent",""),window.close()):"Microsoft Internet Explorer"==a&&(window.opener="whocares",window.close())},LRPG=LRPGStage,LRPGGlobal=LRPGStage,LKeyboard={isEsc:function(){return 1==LRPGStage.shortcuts?27===event.keyCode?!0:!1:(trace("Error: Keyboard shortcuts have closed!"),void 0)},isEnter:function(){return 1==LRPGStage.shortcuts?13===event.keyCode?!0:!1:(trace("Error: Keyboard shortcuts have closed!"),void 0)},isCtrl:function(){return 1==LRPGStage.shortcuts?17===event.keyCode?!0:!1:(trace("Error:Keyboard shortcuts have closed!"),void 0)},isShift:function(){return 1==LRPGStage.shortcuts?16===event.keyCode?!0:!1:(trace("Error:Keyboard shortcuts have closed!"),void 0)},getKeyCode:function(a){return a.keyCode},getKeyName:function(a){return String.fromCharCode(a.keyCode)}},LTileMap.prototype.setData=function(a,b,c,d){var f,g,e=this;e.mapData=a,e.imgData=b,c?e.partWidth=c:(f=new LBitmapData(e.imgData),e.partWidth=f.image.width),d?e.partHeight=d:(g=new LBitmapData(e.imgData),e.partHeight=g.image.height),e.onshow()},LTileMap.prototype.getWidth=function(){var a=this;return a.partWidth*a.mapData[0].length},LTileMap.prototype.getHeight=function(){var a=this;return a.partHeight*a.mapData.length},LTileMap.prototype.showData=function(a){var c,d,e,b=this;for(a||(a="black"),b.textSprite.removeAllChild(),c=0;c<b.mapTerrain.length;c++)for(d=0;d<b.mapTerrain[0].length;d++)e=new LTextField,e.size=b.partWidth/2,e.color=a,e.x=d*b.partWidth+b.partWidth/3,e.y=c*b.partHeight,e.text=b.mapTerrain[c][d],b.textSprite.addChild(e);trace("Map data: "+b.mapData),trace("Images data: "+b.imgData),trace("Small map width: "+b.partWidth),trace("Small map hieght: "+b.partHeight)},LTileMap.prototype.onshow=function(){var b,c,d,e,f,j,k,a=this,g=a.mapData,h=a.partWidth,i=a.partHeight,l=a.x/h,m=a.y/i;for(a.mapSprite.removeAllChild(),b=0;b<g.length;b++)for(c=0;c<g[0].length;c++)d=g[b-m][c-l],f=Math.floor(d/10),e=d-10*f,j=new LBitmapData(a.imgData,e*h,f*i,h,i),k=new LBitmap(j),k.x=c*h-a.x,k.y=b*i-a.y,a.mapSprite.addChild(k)},LEffect.prototype.raining=function(a,b){var c=this;a||(a=30),b||(b=5),c.rainLayer.addEventListener(LEvent.ENTER_FRAME,function(){c.onshow("rain",a,b)})},LEffect.prototype.snowing=function(a,b){var c=this;a||(a=10),b||(b=1),c.snowLayer.addEventListener(LEvent.ENTER_FRAME,function(){c.onshow("snow",a,b)})},LEffect.prototype.sleeting=function(a,b,c){var d=this;a||(a=30),b||(b=1),c||(c=5),d.snowLayer.addEventListener(LEvent.ENTER_FRAME,function(){d.onshow("sleet",a,[b,c])})},LEffect.prototype.onshow=function(a,b,c){var e,f,g,h,d=this;if("rain"==a){for(d.rainLayer.graphics.clear(),e=Math.random()*(LStage.width-10-10)+10,f=d.rainList.length;f--;)g=d.rainList[f],g.y+=g.s,d.rainLayer.graphics.drawRect(1,"white",[g.x,g.y,1,c],!0,"#f3f3f3");d.rainList.push({x:e,y:0,s:b})}else if("snow"==a){for(d.snowLayer.graphics.clear(),h=Math.random()*(LStage.width-10-10)+10,f=d.snowList.length;f--;)g=d.snowList[f],g.y+=g.s,d.snowLayer.graphics.drawArc(2,"white",[g.x,g.y,c,0,2*Math.PI],!0,"white");d.snowList.push({x:h,y:0,s:b})}else if("sleet"==a){for(d.snowLayer.graphics.clear(),h=Math.random()*(LStage.width-10-10)+10,f=d.snowList.length;f--;)g=d.snowList[f],g.y+=g.s,d.snowLayer.graphics.drawArc(2,"white",[g.x,g.y,c[0],0,2*Math.PI],!0,"white");for(d.snowList.push({x:h,y:0,s:b}),d.rainLayer.graphics.clear(),e=Math.random()*(LStage.width-10-10)+10,f=d.rainList.length;f--;)g=d.rainList[f],g.y+=g.s,d.rainLayer.graphics.drawRect(1,"white",[g.x,g.y,1,c[1]],!0,"#f3f3f3");d.rainList.push({x:e,y:0,s:b})}},LCurtainSample1.prototype.onshow=function(a){a.graphics.clear(),a.graphics.drawRect(1,"black",[0,0,a.width1,LStage.height],!0,"black"),a.graphics.drawRect(1,"black",[LStage.width-a.width2,0,a.width2,LStage.height],!0,"black"),a.width1>=LStage.width/2&&(a.mode="open",0==a.isDoClosing&&(a.onClosing(),a.isDoClosing=!0)),"close"==a.mode?(a.width1+=a.speed,a.width2+=a.speed):"open"==a.mode?(a.width1-=a.speed,a.width2-=a.speed,a.width1<0&&(a.mode="stop")):"stop"==a.mode&&(a.graphics.clear(),a.removeEventListener(LEvent.ENTER_FRAME,a.onshow),a.onComplete())},LCurtainSample2.prototype.onshow=function(a){a.graphics.clear(),a.graphics.drawRect(1,"black",[0,0,LStage.width,a.height1],!0,"black"),a.graphics.drawRect(1,"black",[0,LStage.height-a.height2,LStage.width,a.height2],!0,"black"),a.height1>=LStage.height/2&&(a.mode="open",0==a.isDoClosing&&(a.onClosing(),a.isDoClosing=!0)),"close"==a.mode?(a.height1+=a.speed,a.height2+=a.speed):"open"==a.mode?(a.height1-=a.speed,a.height2-=a.speed,a.height1<0&&(a.mode="stop")):"stop"==a.mode&&(a.graphics.clear(),a.removeEventListener(LEvent.ENTER_FRAME,a.onshow),a.onComplete())},LCurtainSample3.prototype.onshow=function(a){a.graphics.clear(),a.graphics.drawRect(1,"black",[0,0,LStage.width,a.height1],!0,"black"),a.graphics.drawRect(1,"black",[0,LStage.height-a.height2,LStage.width,a.height2],!0,"black"),a.graphics.drawRect(1,"black",[0,0,a.width1,LStage.height],!0,"black"),a.graphics.drawRect(1,"black",[LStage.width-a.width2,0,a.width2,LStage.height],!0,"black"),a.height1>=LStage.height/2&&(a.mode="open",0==a.isDoClosing&&(a.onClosing(),a.isDoClosing=!0)),"close"==a.mode?(a.height1+=a.speed,a.height2+=a.speed,a.width1+=a.speed,a.width2+=a.speed):"open"==a.mode?(a.height1-=a.speed,a.height2-=a.speed,a.width1-=a.speed,a.width2-=a.speed,a.height1<0&&(a.mode="stop")):"stop"==a.mode&&(a.graphics.clear(),a.removeEventListener(LEvent.ENTER_FRAME,a.onshow),a.onComplete())},LTalk.prototype.setData=function(a){var b=this;b.content=a},LTalk.prototype.showData=function(){var b,a=this;for(b in a.content)trace("----------No."+b+"----------"),trace("Name: "+a.content[b].name),trace("Msg: "+a.content[b].msg),trace("Face: "+a.content[b].face)},LTalk.prototype.setFaceStyle=function(a){var b=this;b.faceX=a.x?a.x:0,b.faceY=a.y?a.y:0},LTalk.prototype.setNameStyle=function(a){var b=this;b.nameX=a.x?a.x:0,b.nameY=a.y?a.y:0,b.nameColor=a.color?a.color:"black",b.nameFont=a.font?a.font:"宋体",b.nameSize=a.size?a.size:"15"},LTalk.prototype.setMsgStyle=function(a){var b=this;b.msgX=a.x?a.x:0,b.msgY=a.y?a.y:0,b.msgColor=a.color?a.color:"black",b.msgFont=a.font?a.font:"宋体",b.msgSize=a.size?a.size:"15"},LTalk.prototype.wind=function(a,b){var d,e,f,g,h,c=this;a&&null!=a||(a=0),b||(b=null),c.talkIndex=a,c.removeAllChild(),c.talkIndex<c.content.length?(d=c.content[c.talkIndex],e=new LBitmapData(d.face),f=new LBitmap(e),f.x=c.faceX,f.y=c.faceY,c.addChild(f),g=new LTextField,g.x=c.nameX,g.y=c.nameY,g.size=c.nameSize,g.color=c.nameColor,g.font=c.nameFont,g.text=d.name,g.width=c.textWidth,g.setWordWrap(!0,g.getHeight()+5),c.addChild(g),h=new LTextField,h.x=c.msgX,h.y=c.msgY,h.size=c.msgSize,h.color=c.msgColor,h.font=c.msgFont,h.text=d.msg,h.width=c.textWidth,h.setWordWrap(!0,h.getHeight()+7),h.wind(b),c.addChild(h)):trace("Error: Param exceeds the size of the content!")},LTalk.prototype.clear=function(){var a=this;a.removeAllChild(),a.die()},LCharacter.prototype.setData=function(a,b,c,d,e){var g,h,f=this;d||(d=0),void 0==e&&(e=!1),f.speed=d,f.img=a,f.row=b,f.col=c,1==e&&(f.hp=f.hp||0,f.attack=f.attack||0,f.defense=f.defense||0),g=new LBitmapData(a),g.setProperties(0,0,g.image.width/c,g.image.height/b),h=LGlobal.divideCoordinate(g.image.width,g.image.height,b,c),f.imgWidth=g.image.width/c,f.imgHeight=g.image.height/b,f.removeChild(f.anime),f.anime=new LAnimation(f,g,h)},LCharacter.prototype.addActionEventListener=function(a,b){var c=this;c.anime.addEventListener(a,b)},LCharacter.prototype.setAction=function(a,b,c,d){var e=this;e.anime.setAction(a,b,c,d)},LCharacter.prototype.getAction=function(){var a=this,b=a.anime.getAction();return b},LCharacter.prototype.onframe=function(){var a=this;a.speedIndex++<a.speed||(a.speedIndex=0,a.anime.onframe())},LCharacter.prototype.moveTo=function(a,b,c,d,e,f){var h,g=this;switch(c||(c=1),d||(d=Quad.easeIn),e||(e=LMoveStyle.direct),e){case LMoveStyle.direct:h={x:a,y:b,ease:d,onComplete:f},LTweenLite.to(g,c,h);break;case LMoveStyle.horizontal:LTweenLite.to(g,c,{x:a,ease:d,onComplete:function(){LTweenLite.to(g,c,{y:b,ease:d,onComplete:f})}});break;case LMoveStyle.vertical:LTweenLite.to(g,c,{y:b,ease:d,onComplete:function(){LTweenLite.to(g,c,{x:a,ease:d,onComplete:f})}});break;default:trace("Error: Value of last param is wrong!")}},LCharacter.prototype.addName=function(a,b){var d,c=this;c.nameSprite.removeAllChild(),a||(a=0),b||(b=[]),b[0]||(b[0]=0),b[1]||(b[1]=0),b[2]||(b[2]="black"),b[3]||(b[3]="11"),b[4]||(b[4]="utf-8"),d=new LTextField,d.text=a,d.x=b[0],d.y=b[1],d.color=b[2],d.size=b[3],d.font=b[4],c.nameSprite.addChild(d)},LCharacter.prototype.showEffect=function(a,b){var c,d,e,f,g,h,i;switch(b){case LSkill.avatar:a.avatarNum++<3&&(c=a.anime.getAction(),d=c[0],e=c[1],f=new LBitmapData(a.img,e*a.imgWidth,d*a.imgHeight,a.imgWidth,a.imgHeight),g=new LBitmap(f),g.x=0,g.y=0,LTweenLite.to(g,.5,{x:a.imgWidth*a.avatarNum,alpha:.2,ease:Quad.easeIn,onComplete:function(){LTweenLite.to(g,.5,{x:a.imgWidth*a.avatarNum,ease:Quad.easeIn})}}),a.effectSprite.addChild(g),h=new LBitmapData(a.img,e*a.imgWidth,d*a.imgHeight,a.imgWidth,a.imgHeight),i=new LBitmap(h),i.x=0,i.y=0,LTweenLite.to(i,.5,{x:-1*a.imgWidth*a.avatarNum,alpha:.2,ease:Quad.easeIn,onComplete:function(){LTweenLite.to(i,.5,{x:-1*a.imgWidth*a.avatarNum,ease:Quad.easeIn,onComplete:function(){a.avatarNum=0,a.effect=null,a.effectSprite.removeAllChild()}})}}),a.effectSprite.addChild(i));break;case LSkill.flicker:a.flickerNum++<3&&LTweenLite.to(a,.3,{alpha:.5,ease:Quad.easeIn,onComplete:function(){LTweenLite.to(a,.5,{alpha:1,ease:Quad.easeIn,onComplete:function(){a.effect=null,a.flickerNum=0}})}});break;default:trace("Error: LSkill has no property that named '"+b+"'")}},LMoveStyle={horizontal:"horizontal",vertical:"vertical",direct:"direct"},LSkill={avatar:"LSkillAvatar",flicker:"LSkillFlicker"},LHitList.prototype.getList=function(){var a=this,b=a.sprite.childList.length;if("TestRect"==a.type||"TestArc"==a.type){for(;b--;)a.objectB=a.sprite.childList[b],"TestRect"==a.type?a.ishit=LGlobal.hitTest(a.objectA,a.objectB):"TestArc"==a.type&&(a.ishit=LGlobal.hitTestArc(a.objectA,a.objectB)),1==a.ishit&&a.objectB!=a.objectA&&(a.list[a.list.length]=a.sprite.childList[b]);return a.list}trace("Type is wrong. It must be 'TestRect' or 'TestArc'.")},LHitList.prototype.clearList=function(){var a=this;a.list=[]},LBackground.prototype.onshow=function(a){var c,d,e,f,g,h,i,b=this;switch(a){case LBackgroundStyle.tile:for(c=Math.ceil(LStage.width/b.data.image.width),d=Math.ceil(LStage.height/b.data.image.height),e=0;d>e;e++)for(f=0;c>f;f++)g=new LBitmap(b.data),g.x=f*b.data.image.width,g.y=e*b.data.image.height,b.addChild(g);break;case LBackgroundStyle.scale:h=LStage.width/b.data.image.width,i=LStage.height/b.data.image.height,g=new LBitmap(b.data),g.x=0,g.y=0,g.scaleX=h,g.scaleY=i,b.addChild(g);break;default:trace("Error: LBackgroundStyle has no property that named '"+a+"'")}},LBackground.prototype.showData=function(){var a=this;switch(trace("Back data: "+a.data),a.mode){case LBackgroundStyle.tile:trace("Back style: LBackgroundStyle.tile");break;case LBackgroundStyle.scale:trace("Back style: LBackgroundStyle.scale")}},LBackgroundStyle={tile:"backtile",scale:"backscale"},LXMLToArray.prototype.get=function(){var b,c,d,e,f,a=this;switch(a.type){case"map":b=a.xmlDoc.getElementsByTagName("map");break;case"mapdata":b=a.xmlDoc.getElementsByTagName("mapdata");break;default:trace("Error: Value of type is wrong!")}for(c=new Array,d=0;d<b.length;d++)e=b[d].childNodes[0].nodeValue.toString(),f=e.split(","),c.push(f),f=[];return c},LSceneData.prototype={setData:function(a,b,c){var d=this;d.backObj=a,d.charaList=b,d.talkContent=c},showData:function(){var b,a=this;a.backObj.showData(),trace("<br />Character List: ");for(b in a.charaList)trace("----------No."+b+"----------"),trace("Chara: "+a.charaList[b].chara),trace("Data: "+a.charaList[b].data),trace("Row: "+a.charaList[b].row),trace("Col: "+a.charaList[b].col),trace("Speed: "+a.charaList[b].speed),trace("x: "+a.charaList[b].x),trace("y: "+a.charaList[b].y),"player"!=a.charaList[b].chara&&trace("Talk Index: "+a.charaList[b].talkIndex);trace("<br />Talk List: "+a.talkContent)}},LScene.prototype.addWeather=function(){var a=this;a.weatherObj=a.data.weather,a.weatherLayer.addChild(a.weatherObj)},LScene.prototype.addMoveEventListener=function(a,b){var c=this;switch(a){case LEvent.COMPLETE:c.walkCompleteFunc=b}},LScene.prototype.addBackground=function(){var a=this;a.mapLayer.addChild(a.data.backObj)},LScene.prototype.addMap=function(){var b,c,a=this;if(a.mapObj=a.data.backObj,a.mapLayer.addChild(a.mapObj),a.mapTerrain=a.mapObj.mapTerrain,a.mapData=a.mapObj.mapData,a.mapPartWidth=a.mapObj.partWidth,a.mapPartHeight=a.mapObj.partHeight,a.movemapRight=Math.floor(LStage.width/a.mapObj.partWidth)-2,a.movemapLeft=1,a.movemapUp=1,a.movemapDown=Math.floor(LStage.height/a.mapObj.partHeight)-2,a.mapData.length!=a.mapTerrain.length)trace("Warning: Map image array's length is different from map terrain array's length!");else for(b=0;b<a.mapTerrain.length;b++)for(c=0;c<a.mapData.length;c++)a.mapData[c].length!=a.mapTerrain[b].length&&trace("Warning: Map image array's length is different from map terrain array's length!")},LScene.prototype.setMap=function(a,b){var c=this;c.mapCanWalk=a||0,c.mapCannotWalk=b||1},LScene.prototype.addCharacter=function(){var b,c,d,e,f,g,h,i,j,a=this;for(a.charaList=a.data.charaList,b=0;b<a.charaList.length;b++)c=a.charaList[b].data,d=a.charaList[b].row,e=a.charaList[b].col,f=a.charaList[b].speed,g=a.charaList[b].x,h=a.charaList[b].y,i=a.charaList[b].talkIndex,a.step=f,j=new LCharacter(c,d,e,f,!1),"LTileMap"==a.mapObj.type?(j.x=g*a.mapPartWidth,j.y=h*a.mapPartHeight):"LBackground"==a.mapObj.type&&(j.x=g,j.y=h),a.charaLayer.addChild(j),"player"==a.charaList[b].chara?(a.player=j,a.playerX=g,a.playerY=h):(a.mapTerrain[h][g]=a.mapCannotWalk,j.index=i);a.charaLeftStyle=1,a.charaUpStyle=3,a.charaRightStyle=2,a.charaDownStyle=0},LScene.prototype.setCharacter=function(a,b,c,d){var e=this;e.charaLeftStyle=a||0,e.charaUpStyle=c||0,e.charaRightStyle=b||0,e.charaDownStyle=d||0},LPlayerMove={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"},LScene.prototype.movePlayer=function(a){var b=this;if(""==b.player.mode)switch(b.player.mode="ismove",a){case LPlayerMove.LEFT:b.playerDir="left",b.player.setAction(b.charaLeftStyle),b.mapMove=b.mapPartWidth*b.playerX-b.x>b.mapPartWidth&&b.playerX<=b.movemapLeft&&0!=b.x?!0:!1;break;case LPlayerMove.UP:b.playerDir="up",b.player.setAction(b.charaUpStyle),b.mapMove=b.mapPartHeight*b.playerY-b.y>b.mapPartHeight&&b.playerY<=b.movemapUp&&0!=b.y?!0:!1;break;case LPlayerMove.RIGHT:b.playerDir="right",b.player.setAction(b.charaRightStyle),b.mapMove=b.x+b.mapPartWidth<=LStage.width&&b.playerX>=b.movemapRight&&b.x+b.mapObj.getWidth()!=LStage.width?!0:!1;break;case LPlayerMove.DOWN:b.playerDir="down",b.player.setAction(b.charaDownStyle),b.mapMove=b.y+b.mapPartHeight<=LStage.height&&b.playerY>=b.movemapDown&&b.y+b.mapObj.getHeight()!=LStage.height?!0:!1;break;default:b.mapMove=!1,b.player.mode="",trace("Error: Param is wrong!")}},LScene.prototype.onkeydown=function(a){var b=this,c=a.keyCode;switch(c){case 37:b.movePlayer(LPlayerMove.LEFT);break;case 65:b.movePlayer(LPlayerMove.LEFT);break;case 38:b.movePlayer(LPlayerMove.UP);break;case 87:b.movePlayer(LPlayerMove.UP);break;case 39:b.movePlayer(LPlayerMove.RIGHT);break;case 68:b.movePlayer(LPlayerMove.RIGHT);break;case 40:b.movePlayer(LPlayerMove.DOWN);break;case 83:b.movePlayer(LPlayerMove.DOWN)}},LScene.prototype.onkeyup=function(a){var b=this;13==a.keyCode&&b.startTalk()},LScene.prototype.onframe=function(){var b,a=this;if(a.characterList.length>0)for(b in a.characterList)a.characterList[b].onframe();if(a.playerStep==UNDEFINED&&("right"==a.playerDir||"left"==a.playerDir?a.playerStep=a.mapPartWidth/a.step:("down"==a.playerDir||"up"==a.playerDir)&&(a.playerStep=a.mapPartHeight/a.step)),"ismove"==a.player.mode)if(a.stepIndex++<a.step)"right"==a.playerDir&&a.playerX+1<a.mapTerrain[a.playerY].length&&a.mapTerrain[a.playerY][a.playerX+1]==a.mapCanWalk?1!=a.mapMove?(a.player.x+=a.playerStep,a.isWalk=!0):a.moveMap(a.playerDir):"left"==a.playerDir&&a.playerX-1>=0&&a.mapTerrain[a.playerY][a.playerX-1]==a.mapCanWalk?1!=a.mapMove?(a.player.x-=a.playerStep,a.isWalk=!0):a.moveMap(a.playerDir):"up"==a.playerDir&&a.playerY-1>=0&&a.mapTerrain[a.playerY-1][a.playerX]==a.mapCanWalk?1!=a.mapMove?(a.player.y-=a.playerStep,a.isWalk=!0):a.moveMap(a.playerDir):"down"==a.playerDir&&a.playerY+1<a.mapTerrain.length&&a.mapTerrain[a.playerY+1][a.playerX]==a.mapCanWalk&&(1!=a.mapMove?(a.player.y+=a.playerStep,a.isWalk=!0):a.moveMap(a.playerDir));else{if(a.stepIndex=0,a.player.mode="",1==a.mapMove&&1==a.isWalk)switch(a.playerDir){case"right":a.movemapRight+=1,a.movemapLeft+=1;break;case"left":a.movemapLeft-=1,a.movemapRight-=1;break;case"up":a.movemapUp-=1,a.movemapDown-=1;break;case"down":a.movemapDown+=1,a.movemapUp+=1}1==a.isWalk&&("right"==a.playerDir?a.playerX+=1:"left"==a.playerDir?a.playerX-=1:"up"==a.playerDir?a.playerY-=1:"down"==a.playerDir&&(a.playerY+=1),a.isWalk=!1),a.walkCompleteFunc()}},LScene.prototype.walkCompleteFunc=function(){},LScene.prototype.moveMap=function(a){var b=this;switch(a){case"right":b.x-=b.playerStep,b.player.x+=b.playerStep,b.talkLayer.x+=b.playerStep,b.isWalk=!0;break;case"left":b.x+=b.playerStep,b.player.x-=b.playerStep,b.talkLayer.x-=b.playerStep,b.isWalk=!0;break;case"up":b.y+=b.playerStep,b.player.y-=b.playerStep,b.talkLayer.y-=b.playerStep,b.isWalk=!0;break;case"down":b.y-=b.playerStep,b.player.y+=b.playerStep,b.talkLayer.y+=b.playerStep,b.isWalk=!0}},LScene.prototype.startTalk=function(){var d,a=this,b=a.playerX,c=a.playerY;switch(a.playerDir){case"right":b+=1;break;case"left":b-=1;break;case"up":c-=1;break;case"down":c+=1}for(d in a.characterList)a.characterList[d].x/a.mapPartWidth==b&&a.characterList[d].y/a.mapPartHeight==c&&(0==a.talking?a.talkNum<a.talkList[a.characterList[d].index].length&&(a.talk.setData(a.talkList[a.characterList[d].index]),a.addTalk(),a.say(),a.player.mode="cannotmove"):a.talkNum<a.talkList[a.characterList[d].index].length?a.say():(a.talk.clear(),a.player.mode="",a.talking=!1,a.talkNum=0,a.talkLayer.removeAllChild()))},LScene.prototype.say=function(){var a=this;a.talking=!0,a.talk.wind(a.talkNum),a.talkNum++},LScene.prototype.addTalk=function(){var a=this;a.stepIndex=0,a.talkLayer.addChild(a.talkBack),a.talkLayer.addChild(a.talk)},LScene.prototype.setTalkStyle=function(a,b,c,d,e){var f=this;a||(a={x:0,y:0}),b||(b={x:0,y:0,font:"utf-8",size:"15",color:"black"}),c||(c={x:0,y:0,font:"utf-8",size:"15",color:"black"}),d||(d=null),f.talkBack=d,f.talk.setFaceStyle(a),f.talk.setNameStyle(b),f.talk.setMsgStyle(c),f.talk.textWidth=e};